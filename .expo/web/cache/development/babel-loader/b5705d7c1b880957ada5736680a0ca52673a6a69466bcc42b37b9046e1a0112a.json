{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nvar GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent';\nvar GEMINI_API_KEY = process.env.EXPO_PUBLIC_GEMINI_API_KEY || process.env.gemini_2_5_flash_API_key || process.env.GEMINI_API_KEY;\nvar AIStoryService = function () {\n  function AIStoryService() {\n    _classCallCheck(this, AIStoryService);\n    this.conversationHistory = [];\n    this.currentPersona = null;\n    this.sceneCounter = 0;\n  }\n  return _createClass(AIStoryService, [{\n    key: \"startStory\",\n    value: function () {\n      var _startStory = _asyncToGenerator(function* (characterPack) {\n        this.currentPersona = characterPack.persona;\n        this.conversationHistory = [];\n        this.sceneCounter = 0;\n        var initialPrompt = this.buildInitialPrompt(characterPack);\n        try {\n          var response = yield this.generateAIResponse(initialPrompt);\n          return this.parseSceneResponse(response);\n        } catch (error) {\n          console.error('Error starting AI story:', error);\n          return this.getFallbackScene(characterPack);\n        }\n      });\n      function startStory(_x) {\n        return _startStory.apply(this, arguments);\n      }\n      return startStory;\n    }()\n  }, {\n    key: \"generateNextScene\",\n    value: function () {\n      var _generateNextScene = _asyncToGenerator(function* (choice, currentContext) {\n        this.sceneCounter++;\n        var prompt = this.buildContinuationPrompt(choice, currentContext);\n        try {\n          var response = yield this.generateAIResponse(prompt);\n          return this.parseSceneResponse(response);\n        } catch (error) {\n          console.error('Error generating next scene:', error);\n          return this.getFallbackScene();\n        }\n      });\n      function generateNextScene(_x2, _x3) {\n        return _generateNextScene.apply(this, arguments);\n      }\n      return generateNextScene;\n    }()\n  }, {\n    key: \"buildInitialPrompt\",\n    value: function buildInitialPrompt(characterPack) {\n      return `You are an interactive fiction narrator creating a story where the player embodies ${characterPack.persona.name}.\n\nCHARACTER PERSONA:\n- Name: ${characterPack.persona.name}\n- Traits: ${characterPack.persona.traits.join(', ')}\n- Worldview: ${characterPack.persona.worldview}\n- Setting: ${characterPack.persona.setting}\n- Background: ${characterPack.persona.background}\n- Speech Style: ${characterPack.persona.speech_style}\n- Motivations: ${characterPack.persona.motivations.join(', ')}\n- Key Relationships: ${characterPack.persona.relationships.join(', ')}\n- Source Material: ${characterPack.persona.canonical_knowledge}\n\nINSTRUCTIONS:\n1. Create an opening scene that establishes the character and setting\n2. The scene should feel authentic to the source material but allow for player agency\n3. Provide 3-4 meaningful choices that reflect different aspects of the character\n4. Each choice should have a clear persona impact (positive for in-character, negative for out-of-character)\n5. Include vivid descriptions that immerse the player in the world\n\nRespond in this JSON format:\n{\n  \"scene_id\": \"scene_1\",\n  \"title\": \"Scene Title\",\n  \"narration\": \"Detailed scene description and narrative...\",\n  \"ad\": null,\n  \"choices\": [\n    {\n      \"choice_id\": \"1A\",\n      \"text\": \"Choice description\",\n      \"persona_score\": 10,\n      \"reward_ad\": false,\n      \"next_scene\": \"scene_2\"\n    }\n  ]\n}`;\n    }\n  }, {\n    key: \"buildContinuationPrompt\",\n    value: function buildContinuationPrompt(choice, currentContext) {\n      var historyText = this.conversationHistory.slice(-3).map(function (h) {\n        return h.summary;\n      }).join(' ');\n      return `Continue the interactive story for ${this.currentPersona.name}.\n\nPREVIOUS CONTEXT: ${historyText}\n\nPLAYER'S LAST CHOICE: \"${choice.text}\"\nPERSONA IMPACT: ${choice.persona_score > 0 ? 'In-character' : 'Out-of-character'} (${choice.persona_score} points)\n\nCURRENT PERSONA SCORE: ${currentContext.personaScore}/100\nTOTAL CHOICES MADE: ${currentContext.totalChoicesMade}\n\nINSTRUCTIONS:\n1. React to the player's choice naturally within the story world\n2. Continue the narrative in a way that feels authentic to ${this.currentPersona.name}\n3. Introduce new challenges, characters, or situations\n4. Provide 3-4 new choices that test different aspects of the character\n5. If persona score is low, perhaps introduce situations where the character can redeem themselves\n6. If persona score is high, introduce more challenging moral/character dilemmas\n\nCHARACTER REMINDERS:\n- Traits: ${this.currentPersona.traits.join(', ')}\n- Motivations: ${this.currentPersona.motivations.join(', ')}\n- Setting: ${this.currentPersona.setting}\n\nRespond in the same JSON format as before with scene_id \"scene_${this.sceneCounter + 1}\".\n\n${this.sceneCounter >= 8 ? 'IMPORTANT: This should be a climactic scene. If appropriate, one choice can lead to \"end_summary\" to conclude the story.' : ''}`;\n    }\n  }, {\n    key: \"generateAIResponse\",\n    value: function () {\n      var _generateAIResponse = _asyncToGenerator(function* (prompt) {\n        if (!GEMINI_API_KEY) {\n          console.log('No Gemini API key found, using mock responses');\n          return this.getMockAIResponse(prompt);\n        }\n        try {\n          var response = yield fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              contents: [{\n                parts: [{\n                  text: `You are an expert interactive fiction writer specializing in character-driven narratives based on classic literature. \n\n${prompt}\n\nRemember to respond with ONLY the JSON object, no additional text.`\n                }]\n              }],\n              generationConfig: {\n                temperature: 0.8,\n                topK: 40,\n                topP: 0.95,\n                maxOutputTokens: 1000\n              },\n              safetySettings: [{\n                category: \"HARM_CATEGORY_HARASSMENT\",\n                threshold: \"BLOCK_MEDIUM_AND_ABOVE\"\n              }, {\n                category: \"HARM_CATEGORY_HATE_SPEECH\",\n                threshold: \"BLOCK_MEDIUM_AND_ABOVE\"\n              }, {\n                category: \"HARM_CATEGORY_SEXUALLY_EXPLICIT\",\n                threshold: \"BLOCK_MEDIUM_AND_ABOVE\"\n              }, {\n                category: \"HARM_CATEGORY_DANGEROUS_CONTENT\",\n                threshold: \"BLOCK_MEDIUM_AND_ABOVE\"\n              }]\n            })\n          });\n          if (!response.ok) {\n            throw new Error(`Gemini API error: ${response.status} - ${response.statusText}`);\n          }\n          var data = yield response.json();\n          if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {\n            throw new Error('Invalid response from Gemini API');\n          }\n          return data.candidates[0].content.parts[0].text;\n        } catch (error) {\n          console.error('Gemini API call failed:', error);\n          console.log('Falling back to mock responses');\n          return this.getMockAIResponse(prompt);\n        }\n      });\n      function generateAIResponse(_x4) {\n        return _generateAIResponse.apply(this, arguments);\n      }\n      return generateAIResponse;\n    }()\n  }, {\n    key: \"parseSceneResponse\",\n    value: function parseSceneResponse(response) {\n      try {\n        var cleanResponse = response.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n        var jsonMatch = cleanResponse.match(/\\{[\\s\\S]*\\}/);\n        if (!jsonMatch) {\n          throw new Error('No JSON found in response');\n        }\n        var scene = JSON.parse(jsonMatch[0]);\n        if (!scene.scene_id || !scene.narration || !scene.choices) {\n          throw new Error('Invalid scene structure');\n        }\n        this.conversationHistory.push({\n          scene_id: scene.scene_id,\n          summary: scene.narration.substring(0, 200) + '...'\n        });\n        return scene;\n      } catch (error) {\n        console.error('Error parsing AI response:', error);\n        console.log('Response was:', response);\n        return this.getFallbackScene();\n      }\n    }\n  }, {\n    key: \"getMockAIResponse\",\n    value: function getMockAIResponse(prompt) {\n      if (prompt.includes('Sherlock Holmes')) {\n        return `{\n        \"scene_id\": \"scene_${this.sceneCounter + 1}\",\n        \"title\": \"A Case Begins at Baker Street\",\n        \"narration\": \"The morning fog drifts through the windows of 221B Baker Street as you sit in your favorite armchair, contemplating the curious case that has just walked through your door. Mrs. Hudson has shown up a distressed young woman, clutching a torn letter. 'Mr. Holmes,' she pleads, 'my brother has vanished, and the police refuse to help. This letter is the only clue.' You examine the paper with your magnifying glass, noting the peculiar watermark and the trembling handwriting.\",\n        \"ad\": \"Visit Speedy's Caf√© - where even the world's greatest detective stops for a proper cup of tea.\",\n        \"choices\": [\n          {\n            \"choice_id\": \"1A\",\n            \"text\": \"Observe every detail of the letter and the woman with intense scrutiny, making deductions aloud.\",\n            \"persona_score\": 15,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1B\", \n            \"text\": \"Offer immediate comfort to the distressed woman before examining the evidence.\",\n            \"persona_score\": -5,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1C\",\n            \"text\": \"Dismiss the case as trivial and suggest she contact the police again.\",\n            \"persona_score\": -10,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1D\",\n            \"text\": \"Accept the case but demand to examine the woman's living quarters for additional clues.\",\n            \"persona_score\": 10,\n            \"reward_ad\": true,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          }\n        ]\n      }`;\n      }\n      if (prompt.includes('Count Dracula')) {\n        return `{\n        \"scene_id\": \"scene_${this.sceneCounter + 1}\",\n        \"title\": \"Midnight Visitor at Castle Dracula\",\n        \"narration\": \"The ancient stones of your castle echo with the footsteps of an unexpected visitor. From your shadowed alcove, you observe a young man stumbling through your courtyard, clearly lost in the Carpathian mountains. His blood calls to you, warm and inviting, yet something about his bearing suggests he may prove... useful. The moon is full, and your powers are at their peak. How do you choose to receive this mortal?\",\n        \"ad\": \"Discover the finest vintage wines at Transylvanian Cellars - aged to perfection in castle depths.\",\n        \"choices\": [\n          {\n            \"choice_id\": \"1A\",\n            \"text\": \"Appear as a gracious host, welcoming him with aristocratic charm while concealing your true nature.\",\n            \"persona_score\": 15,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1B\",\n            \"text\": \"Transform into mist and observe him from the shadows to assess his intentions.\",\n            \"persona_score\": 10,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1C\",\n            \"text\": \"Immediately reveal your vampiric nature and attempt to feed.\",\n            \"persona_score\": -5,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1D\",\n            \"text\": \"Send your thrall Renfield to investigate while you prepare an elaborate dinner.\",\n            \"persona_score\": 12,\n            \"reward_ad\": true,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          }\n        ]\n      }`;\n      }\n      if (prompt.includes('Elizabeth Bennet')) {\n        return `{\n        \"scene_id\": \"scene_${this.sceneCounter + 1}\",\n        \"title\": \"An Assembly at Meryton\",\n        \"narration\": \"The assembly rooms at Meryton buzz with excitement as you enter alongside Jane and your younger sisters. The local militia officers have arrived, adding considerable charm to the evening's prospects. You notice Mr. Bingley has brought a friend - a tall, handsome gentleman who surveys the room with an air of disdain. Charlotte Lucas approaches with news: 'Lizzy, that gentleman there is Mr. Darcy of Pemberley - ten thousand a year! Though I hear he is quite proud.' What draws your attention this evening?\",\n        \"ad\": \"Elegant gloves and bonnets await at Madame Rousseau's - perfect for any country assembly.\",\n        \"choices\": [\n          {\n            \"choice_id\": \"1A\",\n            \"text\": \"Focus on dancing and conversation, making witty observations about the company.\",\n            \"persona_score\": 15,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1B\",\n            \"text\": \"Approach Mr. Darcy directly to form your own opinion of his character.\",\n            \"persona_score\": 8,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1C\",\n            \"text\": \"Spend the evening gossiping about Mr. Darcy's wealth and status.\",\n            \"persona_score\": -8,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1D\",\n            \"text\": \"Observe everyone quietly to better understand the social dynamics at play.\",\n            \"persona_score\": 10,\n            \"reward_ad\": true,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          }\n        ]\n      }`;\n      }\n      return this.getFallbackSceneJSON();\n    }\n  }, {\n    key: \"getFallbackScene\",\n    value: function getFallbackScene() {\n      var _this$currentPersona;\n      var characterPack = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var character = (characterPack == null ? void 0 : characterPack.character) || ((_this$currentPersona = this.currentPersona) == null ? void 0 : _this$currentPersona.name) || 'the character';\n      return {\n        scene_id: `scene_${this.sceneCounter + 1}`,\n        title: \"An Unexpected Beginning\",\n        narration: `You find yourself in the shoes of ${character}, facing a moment that will define your story. The world around you feels both familiar and full of possibilities. What path will you choose?`,\n        choices: [{\n          choice_id: \"F1\",\n          text: \"Embrace the role fully and act as the character would.\",\n          persona_score: 10,\n          reward_ad: false,\n          next_scene: `scene_${this.sceneCounter + 2}`\n        }, {\n          choice_id: \"F2\",\n          text: \"Take a more cautious approach and observe the situation.\",\n          persona_score: 5,\n          reward_ad: false,\n          next_scene: `scene_${this.sceneCounter + 2}`\n        }, {\n          choice_id: \"F3\",\n          text: \"Do something completely unexpected for this character.\",\n          persona_score: -10,\n          reward_ad: false,\n          next_scene: `scene_${this.sceneCounter + 2}`\n        }]\n      };\n    }\n  }, {\n    key: \"getFallbackSceneJSON\",\n    value: function getFallbackSceneJSON() {\n      return JSON.stringify(this.getFallbackScene());\n    }\n  }, {\n    key: \"calculatePersonaScore\",\n    value: function calculatePersonaScore(choice, characterTraits) {\n      return choice.persona_score || 0;\n    }\n  }]);\n}();\nexport default new AIStoryService();","map":{"version":3,"names":["GEMINI_API_URL","GEMINI_API_KEY","process","env","EXPO_PUBLIC_GEMINI_API_KEY","gemini_2_5_flash_API_key","AIStoryService","_classCallCheck","conversationHistory","currentPersona","sceneCounter","_createClass","key","value","_startStory","_asyncToGenerator","characterPack","persona","initialPrompt","buildInitialPrompt","response","generateAIResponse","parseSceneResponse","error","console","getFallbackScene","startStory","_x","apply","arguments","_generateNextScene","choice","currentContext","prompt","buildContinuationPrompt","generateNextScene","_x2","_x3","name","traits","join","worldview","setting","background","speech_style","motivations","relationships","canonical_knowledge","historyText","slice","map","h","summary","text","persona_score","personaScore","totalChoicesMade","_generateAIResponse","log","getMockAIResponse","fetch","method","headers","body","JSON","stringify","contents","parts","generationConfig","temperature","topK","topP","maxOutputTokens","safetySettings","category","threshold","ok","Error","status","statusText","data","json","candidates","content","_x4","cleanResponse","replace","trim","jsonMatch","match","scene","parse","scene_id","narration","choices","push","substring","includes","getFallbackSceneJSON","_this$currentPersona","length","undefined","character","title","choice_id","reward_ad","next_scene","calculatePersonaScore","characterTraits"],"sources":["/Users/akerim/cursorProjects/canonCraft/aiService.js"],"sourcesContent":["// AI Service for Dynamic Story Generation\n// This service generates scenes, choices, and narrative content based on character personas\n\nconst GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent';\nconst GEMINI_API_KEY = process.env.EXPO_PUBLIC_GEMINI_API_KEY || process.env.gemini_2_5_flash_API_key || process.env.GEMINI_API_KEY;\n\nclass AIStoryService {\n  constructor() {\n    this.conversationHistory = [];\n    this.currentPersona = null;\n    this.sceneCounter = 0;\n  }\n\n  // Initialize a new story with character persona\n  async startStory(characterPack) {\n    this.currentPersona = characterPack.persona;\n    this.conversationHistory = [];\n    this.sceneCounter = 0;\n\n    const initialPrompt = this.buildInitialPrompt(characterPack);\n    \n    try {\n      const response = await this.generateAIResponse(initialPrompt);\n      return this.parseSceneResponse(response);\n    } catch (error) {\n      console.error('Error starting AI story:', error);\n      return this.getFallbackScene(characterPack);\n    }\n  }\n\n  // Generate next scene based on player choice\n  async generateNextScene(choice, currentContext) {\n    this.sceneCounter++;\n    \n    const prompt = this.buildContinuationPrompt(choice, currentContext);\n    \n    try {\n      const response = await this.generateAIResponse(prompt);\n      return this.parseSceneResponse(response);\n    } catch (error) {\n      console.error('Error generating next scene:', error);\n      return this.getFallbackScene();\n    }\n  }\n\n  // Build initial story prompt\n  buildInitialPrompt(characterPack) {\n    return `You are an interactive fiction narrator creating a story where the player embodies ${characterPack.persona.name}.\n\nCHARACTER PERSONA:\n- Name: ${characterPack.persona.name}\n- Traits: ${characterPack.persona.traits.join(', ')}\n- Worldview: ${characterPack.persona.worldview}\n- Setting: ${characterPack.persona.setting}\n- Background: ${characterPack.persona.background}\n- Speech Style: ${characterPack.persona.speech_style}\n- Motivations: ${characterPack.persona.motivations.join(', ')}\n- Key Relationships: ${characterPack.persona.relationships.join(', ')}\n- Source Material: ${characterPack.persona.canonical_knowledge}\n\nINSTRUCTIONS:\n1. Create an opening scene that establishes the character and setting\n2. The scene should feel authentic to the source material but allow for player agency\n3. Provide 3-4 meaningful choices that reflect different aspects of the character\n4. Each choice should have a clear persona impact (positive for in-character, negative for out-of-character)\n5. Include vivid descriptions that immerse the player in the world\n\nRespond in this JSON format:\n{\n  \"scene_id\": \"scene_1\",\n  \"title\": \"Scene Title\",\n  \"narration\": \"Detailed scene description and narrative...\",\n  \"ad\": null,\n  \"choices\": [\n    {\n      \"choice_id\": \"1A\",\n      \"text\": \"Choice description\",\n      \"persona_score\": 10,\n      \"reward_ad\": false,\n      \"next_scene\": \"scene_2\"\n    }\n  ]\n}`;\n  }\n\n  // Build continuation prompt based on player choice\n  buildContinuationPrompt(choice, currentContext) {\n    const historyText = this.conversationHistory.slice(-3).map(h => h.summary).join(' ');\n    \n    return `Continue the interactive story for ${this.currentPersona.name}.\n\nPREVIOUS CONTEXT: ${historyText}\n\nPLAYER'S LAST CHOICE: \"${choice.text}\"\nPERSONA IMPACT: ${choice.persona_score > 0 ? 'In-character' : 'Out-of-character'} (${choice.persona_score} points)\n\nCURRENT PERSONA SCORE: ${currentContext.personaScore}/100\nTOTAL CHOICES MADE: ${currentContext.totalChoicesMade}\n\nINSTRUCTIONS:\n1. React to the player's choice naturally within the story world\n2. Continue the narrative in a way that feels authentic to ${this.currentPersona.name}\n3. Introduce new challenges, characters, or situations\n4. Provide 3-4 new choices that test different aspects of the character\n5. If persona score is low, perhaps introduce situations where the character can redeem themselves\n6. If persona score is high, introduce more challenging moral/character dilemmas\n\nCHARACTER REMINDERS:\n- Traits: ${this.currentPersona.traits.join(', ')}\n- Motivations: ${this.currentPersona.motivations.join(', ')}\n- Setting: ${this.currentPersona.setting}\n\nRespond in the same JSON format as before with scene_id \"scene_${this.sceneCounter + 1}\".\n\n${this.sceneCounter >= 8 ? 'IMPORTANT: This should be a climactic scene. If appropriate, one choice can lead to \"end_summary\" to conclude the story.' : ''}`;\n  }\n\n  // Call Gemini API\n  async generateAIResponse(prompt) {\n    // For demo purposes, return mock data if no API key is provided\n    if (!GEMINI_API_KEY) {\n      console.log('No Gemini API key found, using mock responses');\n      return this.getMockAIResponse(prompt);\n    }\n\n    try {\n      const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          contents: [\n            {\n              parts: [\n                {\n                  text: `You are an expert interactive fiction writer specializing in character-driven narratives based on classic literature. \n\n${prompt}\n\nRemember to respond with ONLY the JSON object, no additional text.`\n                }\n              ]\n            }\n          ],\n          generationConfig: {\n            temperature: 0.8,\n            topK: 40,\n            topP: 0.95,\n            maxOutputTokens: 1000,\n          },\n          safetySettings: [\n            {\n              category: \"HARM_CATEGORY_HARASSMENT\",\n              threshold: \"BLOCK_MEDIUM_AND_ABOVE\"\n            },\n            {\n              category: \"HARM_CATEGORY_HATE_SPEECH\",\n              threshold: \"BLOCK_MEDIUM_AND_ABOVE\"\n            },\n            {\n              category: \"HARM_CATEGORY_SEXUALLY_EXPLICIT\",\n              threshold: \"BLOCK_MEDIUM_AND_ABOVE\"\n            },\n            {\n              category: \"HARM_CATEGORY_DANGEROUS_CONTENT\",\n              threshold: \"BLOCK_MEDIUM_AND_ABOVE\"\n            }\n          ]\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Gemini API error: ${response.status} - ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      \n      if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {\n        throw new Error('Invalid response from Gemini API');\n      }\n\n      return data.candidates[0].content.parts[0].text;\n    } catch (error) {\n      console.error('Gemini API call failed:', error);\n      console.log('Falling back to mock responses');\n      return this.getMockAIResponse(prompt);\n    }\n  }\n\n  // Parse AI response into scene object\n  parseSceneResponse(response) {\n    try {\n      // Clean the response - remove any markdown code blocks\n      let cleanResponse = response.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n      \n      // Extract JSON from response (in case AI adds extra text)\n      const jsonMatch = cleanResponse.match(/\\{[\\s\\S]*\\}/);\n      if (!jsonMatch) {\n        throw new Error('No JSON found in response');\n      }\n      \n      const scene = JSON.parse(jsonMatch[0]);\n      \n      // Validate required fields\n      if (!scene.scene_id || !scene.narration || !scene.choices) {\n        throw new Error('Invalid scene structure');\n      }\n\n      // Add to conversation history\n      this.conversationHistory.push({\n        scene_id: scene.scene_id,\n        summary: scene.narration.substring(0, 200) + '...'\n      });\n\n      return scene;\n    } catch (error) {\n      console.error('Error parsing AI response:', error);\n      console.log('Response was:', response);\n      return this.getFallbackScene();\n    }\n  }\n\n  // Mock AI response for demo/testing\n  getMockAIResponse(prompt) {\n    if (prompt.includes('Sherlock Holmes')) {\n      return `{\n        \"scene_id\": \"scene_${this.sceneCounter + 1}\",\n        \"title\": \"A Case Begins at Baker Street\",\n        \"narration\": \"The morning fog drifts through the windows of 221B Baker Street as you sit in your favorite armchair, contemplating the curious case that has just walked through your door. Mrs. Hudson has shown up a distressed young woman, clutching a torn letter. 'Mr. Holmes,' she pleads, 'my brother has vanished, and the police refuse to help. This letter is the only clue.' You examine the paper with your magnifying glass, noting the peculiar watermark and the trembling handwriting.\",\n        \"ad\": \"Visit Speedy's Caf√© - where even the world's greatest detective stops for a proper cup of tea.\",\n        \"choices\": [\n          {\n            \"choice_id\": \"1A\",\n            \"text\": \"Observe every detail of the letter and the woman with intense scrutiny, making deductions aloud.\",\n            \"persona_score\": 15,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1B\", \n            \"text\": \"Offer immediate comfort to the distressed woman before examining the evidence.\",\n            \"persona_score\": -5,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1C\",\n            \"text\": \"Dismiss the case as trivial and suggest she contact the police again.\",\n            \"persona_score\": -10,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1D\",\n            \"text\": \"Accept the case but demand to examine the woman's living quarters for additional clues.\",\n            \"persona_score\": 10,\n            \"reward_ad\": true,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          }\n        ]\n      }`;\n    }\n\n    if (prompt.includes('Count Dracula')) {\n      return `{\n        \"scene_id\": \"scene_${this.sceneCounter + 1}\",\n        \"title\": \"Midnight Visitor at Castle Dracula\",\n        \"narration\": \"The ancient stones of your castle echo with the footsteps of an unexpected visitor. From your shadowed alcove, you observe a young man stumbling through your courtyard, clearly lost in the Carpathian mountains. His blood calls to you, warm and inviting, yet something about his bearing suggests he may prove... useful. The moon is full, and your powers are at their peak. How do you choose to receive this mortal?\",\n        \"ad\": \"Discover the finest vintage wines at Transylvanian Cellars - aged to perfection in castle depths.\",\n        \"choices\": [\n          {\n            \"choice_id\": \"1A\",\n            \"text\": \"Appear as a gracious host, welcoming him with aristocratic charm while concealing your true nature.\",\n            \"persona_score\": 15,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1B\",\n            \"text\": \"Transform into mist and observe him from the shadows to assess his intentions.\",\n            \"persona_score\": 10,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1C\",\n            \"text\": \"Immediately reveal your vampiric nature and attempt to feed.\",\n            \"persona_score\": -5,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1D\",\n            \"text\": \"Send your thrall Renfield to investigate while you prepare an elaborate dinner.\",\n            \"persona_score\": 12,\n            \"reward_ad\": true,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          }\n        ]\n      }`;\n    }\n\n    if (prompt.includes('Elizabeth Bennet')) {\n      return `{\n        \"scene_id\": \"scene_${this.sceneCounter + 1}\",\n        \"title\": \"An Assembly at Meryton\",\n        \"narration\": \"The assembly rooms at Meryton buzz with excitement as you enter alongside Jane and your younger sisters. The local militia officers have arrived, adding considerable charm to the evening's prospects. You notice Mr. Bingley has brought a friend - a tall, handsome gentleman who surveys the room with an air of disdain. Charlotte Lucas approaches with news: 'Lizzy, that gentleman there is Mr. Darcy of Pemberley - ten thousand a year! Though I hear he is quite proud.' What draws your attention this evening?\",\n        \"ad\": \"Elegant gloves and bonnets await at Madame Rousseau's - perfect for any country assembly.\",\n        \"choices\": [\n          {\n            \"choice_id\": \"1A\",\n            \"text\": \"Focus on dancing and conversation, making witty observations about the company.\",\n            \"persona_score\": 15,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1B\",\n            \"text\": \"Approach Mr. Darcy directly to form your own opinion of his character.\",\n            \"persona_score\": 8,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1C\",\n            \"text\": \"Spend the evening gossiping about Mr. Darcy's wealth and status.\",\n            \"persona_score\": -8,\n            \"reward_ad\": false,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          },\n          {\n            \"choice_id\": \"1D\",\n            \"text\": \"Observe everyone quietly to better understand the social dynamics at play.\",\n            \"persona_score\": 10,\n            \"reward_ad\": true,\n            \"next_scene\": \"scene_${this.sceneCounter + 2}\"\n          }\n        ]\n      }`;\n    }\n\n    // Generic fallback\n    return this.getFallbackSceneJSON();\n  }\n\n  // Fallback scene for errors\n  getFallbackScene(characterPack = null) {\n    const character = characterPack?.character || this.currentPersona?.name || 'the character';\n    \n    return {\n      scene_id: `scene_${this.sceneCounter + 1}`,\n      title: \"An Unexpected Beginning\",\n      narration: `You find yourself in the shoes of ${character}, facing a moment that will define your story. The world around you feels both familiar and full of possibilities. What path will you choose?`,\n      choices: [\n        {\n          choice_id: \"F1\",\n          text: \"Embrace the role fully and act as the character would.\",\n          persona_score: 10,\n          reward_ad: false,\n          next_scene: `scene_${this.sceneCounter + 2}`\n        },\n        {\n          choice_id: \"F2\", \n          text: \"Take a more cautious approach and observe the situation.\",\n          persona_score: 5,\n          reward_ad: false,\n          next_scene: `scene_${this.sceneCounter + 2}`\n        },\n        {\n          choice_id: \"F3\",\n          text: \"Do something completely unexpected for this character.\",\n          persona_score: -10,\n          reward_ad: false,\n          next_scene: `scene_${this.sceneCounter + 2}`\n        }\n      ]\n    };\n  }\n\n  getFallbackSceneJSON() {\n    return JSON.stringify(this.getFallbackScene());\n  }\n\n  // Calculate persona score for a choice\n  calculatePersonaScore(choice, characterTraits) {\n    // This would be more sophisticated in a real implementation\n    // For now, we rely on the AI to provide appropriate scores\n    return choice.persona_score || 0;\n  }\n}\n\nexport default new AIStoryService(); "],"mappings":";;;AAGA,IAAMA,cAAc,GAAG,iGAAiG;AACxH,IAAMC,cAAc,GAAGC,OAAO,CAACC,GAAG,CAACC,0BAA0B,IAAIF,OAAO,CAACC,GAAG,CAACE,wBAAwB,IAAIH,OAAO,CAACC,GAAG,CAACF,cAAc;AAAC,IAE9HK,cAAc;EAClB,SAAAA,eAAA,EAAc;IAAAC,eAAA,OAAAD,cAAA;IACZ,IAAI,CAACE,mBAAmB,GAAG,EAAE;IAC7B,IAAI,CAACC,cAAc,GAAG,IAAI;IAC1B,IAAI,CAACC,YAAY,GAAG,CAAC;EACvB;EAAC,OAAAC,YAAA,CAAAL,cAAA;IAAAM,GAAA;IAAAC,KAAA;MAAA,IAAAC,WAAA,GAAAC,iBAAA,CAGD,WAAiBC,aAAa,EAAE;QAC9B,IAAI,CAACP,cAAc,GAAGO,aAAa,CAACC,OAAO;QAC3C,IAAI,CAACT,mBAAmB,GAAG,EAAE;QAC7B,IAAI,CAACE,YAAY,GAAG,CAAC;QAErB,IAAMQ,aAAa,GAAG,IAAI,CAACC,kBAAkB,CAACH,aAAa,CAAC;QAE5D,IAAI;UACF,IAAMI,QAAQ,SAAS,IAAI,CAACC,kBAAkB,CAACH,aAAa,CAAC;UAC7D,OAAO,IAAI,CAACI,kBAAkB,CAACF,QAAQ,CAAC;QAC1C,CAAC,CAAC,OAAOG,KAAK,EAAE;UACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;UAChD,OAAO,IAAI,CAACE,gBAAgB,CAACT,aAAa,CAAC;QAC7C;MACF,CAAC;MAAA,SAdKU,UAAUA,CAAAC,EAAA;QAAA,OAAAb,WAAA,CAAAc,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAVH,UAAU;IAAA;EAAA;IAAAd,GAAA;IAAAC,KAAA;MAAA,IAAAiB,kBAAA,GAAAf,iBAAA,CAiBhB,WAAwBgB,MAAM,EAAEC,cAAc,EAAE;QAC9C,IAAI,CAACtB,YAAY,EAAE;QAEnB,IAAMuB,MAAM,GAAG,IAAI,CAACC,uBAAuB,CAACH,MAAM,EAAEC,cAAc,CAAC;QAEnE,IAAI;UACF,IAAMZ,QAAQ,SAAS,IAAI,CAACC,kBAAkB,CAACY,MAAM,CAAC;UACtD,OAAO,IAAI,CAACX,kBAAkB,CAACF,QAAQ,CAAC;QAC1C,CAAC,CAAC,OAAOG,KAAK,EAAE;UACdC,OAAO,CAACD,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;UACpD,OAAO,IAAI,CAACE,gBAAgB,CAAC,CAAC;QAChC;MACF,CAAC;MAAA,SAZKU,iBAAiBA,CAAAC,GAAA,EAAAC,GAAA;QAAA,OAAAP,kBAAA,CAAAF,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAjBM,iBAAiB;IAAA;EAAA;IAAAvB,GAAA;IAAAC,KAAA,EAevB,SAAAM,kBAAkBA,CAACH,aAAa,EAAE;MAChC,OAAO,sFAAsFA,aAAa,CAACC,OAAO,CAACqB,IAAI;AAC3H;AACA;AACA,UAAUtB,aAAa,CAACC,OAAO,CAACqB,IAAI;AACpC,YAAYtB,aAAa,CAACC,OAAO,CAACsB,MAAM,CAACC,IAAI,CAAC,IAAI,CAAC;AACnD,eAAexB,aAAa,CAACC,OAAO,CAACwB,SAAS;AAC9C,aAAazB,aAAa,CAACC,OAAO,CAACyB,OAAO;AAC1C,gBAAgB1B,aAAa,CAACC,OAAO,CAAC0B,UAAU;AAChD,kBAAkB3B,aAAa,CAACC,OAAO,CAAC2B,YAAY;AACpD,iBAAiB5B,aAAa,CAACC,OAAO,CAAC4B,WAAW,CAACL,IAAI,CAAC,IAAI,CAAC;AAC7D,uBAAuBxB,aAAa,CAACC,OAAO,CAAC6B,aAAa,CAACN,IAAI,CAAC,IAAI,CAAC;AACrE,qBAAqBxB,aAAa,CAACC,OAAO,CAAC8B,mBAAmB;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;IACA;EAAC;IAAAnC,GAAA;IAAAC,KAAA,EAGD,SAAAqB,uBAAuBA,CAACH,MAAM,EAAEC,cAAc,EAAE;MAC9C,IAAMgB,WAAW,GAAG,IAAI,CAACxC,mBAAmB,CAACyC,KAAK,CAAC,CAAC,CAAC,CAAC,CAACC,GAAG,CAAC,UAAAC,CAAC;QAAA,OAAIA,CAAC,CAACC,OAAO;MAAA,EAAC,CAACZ,IAAI,CAAC,GAAG,CAAC;MAEpF,OAAO,sCAAsC,IAAI,CAAC/B,cAAc,CAAC6B,IAAI;AACzE;AACA,oBAAoBU,WAAW;AAC/B;AACA,yBAAyBjB,MAAM,CAACsB,IAAI;AACpC,kBAAkBtB,MAAM,CAACuB,aAAa,GAAG,CAAC,GAAG,cAAc,GAAG,kBAAkB,KAAKvB,MAAM,CAACuB,aAAa;AACzG;AACA,yBAAyBtB,cAAc,CAACuB,YAAY;AACpD,sBAAsBvB,cAAc,CAACwB,gBAAgB;AACrD;AACA;AACA;AACA,6DAA6D,IAAI,CAAC/C,cAAc,CAAC6B,IAAI;AACrF;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,IAAI,CAAC7B,cAAc,CAAC8B,MAAM,CAACC,IAAI,CAAC,IAAI,CAAC;AACjD,iBAAiB,IAAI,CAAC/B,cAAc,CAACoC,WAAW,CAACL,IAAI,CAAC,IAAI,CAAC;AAC3D,aAAa,IAAI,CAAC/B,cAAc,CAACiC,OAAO;AACxC;AACA,iEAAiE,IAAI,CAAChC,YAAY,GAAG,CAAC;AACtF;AACA,EAAE,IAAI,CAACA,YAAY,IAAI,CAAC,GAAG,0HAA0H,GAAG,EAAE,EAAE;IAC1J;EAAC;IAAAE,GAAA;IAAAC,KAAA;MAAA,IAAA4C,mBAAA,GAAA1C,iBAAA,CAGD,WAAyBkB,MAAM,EAAE;QAE/B,IAAI,CAAChC,cAAc,EAAE;UACnBuB,OAAO,CAACkC,GAAG,CAAC,+CAA+C,CAAC;UAC5D,OAAO,IAAI,CAACC,iBAAiB,CAAC1B,MAAM,CAAC;QACvC;QAEA,IAAI;UACF,IAAMb,QAAQ,SAASwC,KAAK,CAAC,GAAG5D,cAAc,QAAQC,cAAc,EAAE,EAAE;YACtE4D,MAAM,EAAE,MAAM;YACdC,OAAO,EAAE;cACP,cAAc,EAAE;YAClB,CAAC;YACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;cACnBC,QAAQ,EAAE,CACR;gBACEC,KAAK,EAAE,CACL;kBACEd,IAAI,EAAE;AACxB;AACA,EAAEpB,MAAM;AACR;AACA;gBACgB,CAAC;cAEL,CAAC,CACF;cACDmC,gBAAgB,EAAE;gBAChBC,WAAW,EAAE,GAAG;gBAChBC,IAAI,EAAE,EAAE;gBACRC,IAAI,EAAE,IAAI;gBACVC,eAAe,EAAE;cACnB,CAAC;cACDC,cAAc,EAAE,CACd;gBACEC,QAAQ,EAAE,0BAA0B;gBACpCC,SAAS,EAAE;cACb,CAAC,EACD;gBACED,QAAQ,EAAE,2BAA2B;gBACrCC,SAAS,EAAE;cACb,CAAC,EACD;gBACED,QAAQ,EAAE,iCAAiC;gBAC3CC,SAAS,EAAE;cACb,CAAC,EACD;gBACED,QAAQ,EAAE,iCAAiC;gBAC3CC,SAAS,EAAE;cACb,CAAC;YAEL,CAAC;UACH,CAAC,CAAC;UAEF,IAAI,CAACvD,QAAQ,CAACwD,EAAE,EAAE;YAChB,MAAM,IAAIC,KAAK,CAAC,qBAAqBzD,QAAQ,CAAC0D,MAAM,MAAM1D,QAAQ,CAAC2D,UAAU,EAAE,CAAC;UAClF;UAEA,IAAMC,IAAI,SAAS5D,QAAQ,CAAC6D,IAAI,CAAC,CAAC;UAElC,IAAI,CAACD,IAAI,CAACE,UAAU,IAAI,CAACF,IAAI,CAACE,UAAU,CAAC,CAAC,CAAC,IAAI,CAACF,IAAI,CAACE,UAAU,CAAC,CAAC,CAAC,CAACC,OAAO,EAAE;YAC1E,MAAM,IAAIN,KAAK,CAAC,kCAAkC,CAAC;UACrD;UAEA,OAAOG,IAAI,CAACE,UAAU,CAAC,CAAC,CAAC,CAACC,OAAO,CAAChB,KAAK,CAAC,CAAC,CAAC,CAACd,IAAI;QACjD,CAAC,CAAC,OAAO9B,KAAK,EAAE;UACdC,OAAO,CAACD,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;UAC/CC,OAAO,CAACkC,GAAG,CAAC,gCAAgC,CAAC;UAC7C,OAAO,IAAI,CAACC,iBAAiB,CAAC1B,MAAM,CAAC;QACvC;MACF,CAAC;MAAA,SAtEKZ,kBAAkBA,CAAA+D,GAAA;QAAA,OAAA3B,mBAAA,CAAA7B,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAlBR,kBAAkB;IAAA;EAAA;IAAAT,GAAA;IAAAC,KAAA,EAyExB,SAAAS,kBAAkBA,CAACF,QAAQ,EAAE;MAC3B,IAAI;QAEF,IAAIiE,aAAa,GAAGjE,QAAQ,CAACkE,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,CAACC,IAAI,CAAC,CAAC;QAGrF,IAAMC,SAAS,GAAGH,aAAa,CAACI,KAAK,CAAC,aAAa,CAAC;QACpD,IAAI,CAACD,SAAS,EAAE;UACd,MAAM,IAAIX,KAAK,CAAC,2BAA2B,CAAC;QAC9C;QAEA,IAAMa,KAAK,GAAG1B,IAAI,CAAC2B,KAAK,CAACH,SAAS,CAAC,CAAC,CAAC,CAAC;QAGtC,IAAI,CAACE,KAAK,CAACE,QAAQ,IAAI,CAACF,KAAK,CAACG,SAAS,IAAI,CAACH,KAAK,CAACI,OAAO,EAAE;UACzD,MAAM,IAAIjB,KAAK,CAAC,yBAAyB,CAAC;QAC5C;QAGA,IAAI,CAACrE,mBAAmB,CAACuF,IAAI,CAAC;UAC5BH,QAAQ,EAAEF,KAAK,CAACE,QAAQ;UACxBxC,OAAO,EAAEsC,KAAK,CAACG,SAAS,CAACG,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC,GAAG;QAC/C,CAAC,CAAC;QAEF,OAAON,KAAK;MACd,CAAC,CAAC,OAAOnE,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;QAClDC,OAAO,CAACkC,GAAG,CAAC,eAAe,EAAEtC,QAAQ,CAAC;QACtC,OAAO,IAAI,CAACK,gBAAgB,CAAC,CAAC;MAChC;IACF;EAAC;IAAAb,GAAA;IAAAC,KAAA,EAGD,SAAA8C,iBAAiBA,CAAC1B,MAAM,EAAE;MACxB,IAAIA,MAAM,CAACgE,QAAQ,CAAC,iBAAiB,CAAC,EAAE;QACtC,OAAO;AACb,6BAA6B,IAAI,CAACvF,YAAY,GAAG,CAAC;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,IAAI,CAACA,YAAY,GAAG,CAAC;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,IAAI,CAACA,YAAY,GAAG,CAAC;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,IAAI,CAACA,YAAY,GAAG,CAAC;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,IAAI,CAACA,YAAY,GAAG,CAAC;AACxD;AACA;AACA,QAAQ;MACJ;MAEA,IAAIuB,MAAM,CAACgE,QAAQ,CAAC,eAAe,CAAC,EAAE;QACpC,OAAO;AACb,6BAA6B,IAAI,CAACvF,YAAY,GAAG,CAAC;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,IAAI,CAACA,YAAY,GAAG,CAAC;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,IAAI,CAACA,YAAY,GAAG,CAAC;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,IAAI,CAACA,YAAY,GAAG,CAAC;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,IAAI,CAACA,YAAY,GAAG,CAAC;AACxD;AACA;AACA,QAAQ;MACJ;MAEA,IAAIuB,MAAM,CAACgE,QAAQ,CAAC,kBAAkB,CAAC,EAAE;QACvC,OAAO;AACb,6BAA6B,IAAI,CAACvF,YAAY,GAAG,CAAC;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,IAAI,CAACA,YAAY,GAAG,CAAC;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,IAAI,CAACA,YAAY,GAAG,CAAC;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,IAAI,CAACA,YAAY,GAAG,CAAC;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,IAAI,CAACA,YAAY,GAAG,CAAC;AACxD;AACA;AACA,QAAQ;MACJ;MAGA,OAAO,IAAI,CAACwF,oBAAoB,CAAC,CAAC;IACpC;EAAC;IAAAtF,GAAA;IAAAC,KAAA,EAGD,SAAAY,gBAAgBA,CAAA,EAAuB;MAAA,IAAA0E,oBAAA;MAAA,IAAtBnF,aAAa,GAAAa,SAAA,CAAAuE,MAAA,QAAAvE,SAAA,QAAAwE,SAAA,GAAAxE,SAAA,MAAG,IAAI;MACnC,IAAMyE,SAAS,GAAG,CAAAtF,aAAa,oBAAbA,aAAa,CAAEsF,SAAS,OAAAH,oBAAA,GAAI,IAAI,CAAC1F,cAAc,qBAAnB0F,oBAAA,CAAqB7D,IAAI,KAAI,eAAe;MAE1F,OAAO;QACLsD,QAAQ,EAAE,SAAS,IAAI,CAAClF,YAAY,GAAG,CAAC,EAAE;QAC1C6F,KAAK,EAAE,yBAAyB;QAChCV,SAAS,EAAE,qCAAqCS,SAAS,+IAA+I;QACxMR,OAAO,EAAE,CACP;UACEU,SAAS,EAAE,IAAI;UACfnD,IAAI,EAAE,wDAAwD;UAC9DC,aAAa,EAAE,EAAE;UACjBmD,SAAS,EAAE,KAAK;UAChBC,UAAU,EAAE,SAAS,IAAI,CAAChG,YAAY,GAAG,CAAC;QAC5C,CAAC,EACD;UACE8F,SAAS,EAAE,IAAI;UACfnD,IAAI,EAAE,0DAA0D;UAChEC,aAAa,EAAE,CAAC;UAChBmD,SAAS,EAAE,KAAK;UAChBC,UAAU,EAAE,SAAS,IAAI,CAAChG,YAAY,GAAG,CAAC;QAC5C,CAAC,EACD;UACE8F,SAAS,EAAE,IAAI;UACfnD,IAAI,EAAE,wDAAwD;UAC9DC,aAAa,EAAE,CAAC,EAAE;UAClBmD,SAAS,EAAE,KAAK;UAChBC,UAAU,EAAE,SAAS,IAAI,CAAChG,YAAY,GAAG,CAAC;QAC5C,CAAC;MAEL,CAAC;IACH;EAAC;IAAAE,GAAA;IAAAC,KAAA,EAED,SAAAqF,oBAAoBA,CAAA,EAAG;MACrB,OAAOlC,IAAI,CAACC,SAAS,CAAC,IAAI,CAACxC,gBAAgB,CAAC,CAAC,CAAC;IAChD;EAAC;IAAAb,GAAA;IAAAC,KAAA,EAGD,SAAA8F,qBAAqBA,CAAC5E,MAAM,EAAE6E,eAAe,EAAE;MAG7C,OAAO7E,MAAM,CAACuB,aAAa,IAAI,CAAC;IAClC;EAAC;AAAA;AAGH,eAAe,IAAIhD,cAAc,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}